## watch 实现原理

> watch，本质是对响应式数据的检测，当响应式数据发生变化时，通知并执行相应的回调函数.

#### 实现思路

> 前提依赖`effect`与`schduler`

1. 运用响应式系统依赖于副作用建立的对应关系，在副作用初始调度时，传入 schduler 选项
2. 当`schduler`传入时，并且响应式数据发生变化时，为`watch`调度指定的回调动作，响应监听更新.

#### 优化

> 在第一版的`watch`实现中, 采用硬编码的方式，监听`foo`数据变化。现在的改进中，可以任意监听`source`数据的变化

1. `watch`接收数据对象，作为监听源
2. `watch`接收函数`getter`监听数据源指定数据
3. `watch`回调数据的接收

## 立即执行`watch`与`watch`回调执行时机

> 关于 watch 基本是实现中，扩展特性，立即执行回调；回调执行时机

- 立即执行 watch 函数的回调函数
- 回调执行时机

## 竞态条件

> 出现在的场景在于，同步更新同一个副作用时，如果副作用内部存在异步任务，就会导致同时触发多个异步任务的执行。如果存在更新，那么将会导致更新的不一致性
> 为了解决这个问题，需要为 watch 开启一个标志标量，来校验副作用函数的有效性
